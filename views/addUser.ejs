<%- include('./partials/header.ejs'); %>

<%- include('./partials/navbar.ejs'); %>

<%- include('./partials/sidebar.ejs'); %>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="py-5 text-center">
                    <img class="d-block mx-auto mb-4" src="/images/bootstrap/bootstrap-logo.svg" alt="" width="72" height="57">
                    <h2>User Registration Form</h2>
                    <a href="/users">Go Back</a>
                </div>
                
                <div class="row g-5">
                    <div class="col-md-8 col-lg-8 offset-md-2">
                        <form id="add-user-form" method="post" action="/users/add" class="needs-validation" novalidate enctype="multipart/form-data">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label for="name" class="form-label">Name</label>
                                    <input type="text" name="name" id="name" class="form-control" placeholder="Full Name" required>
                                    <div class="invalid-feedback name-error">
                                        Valid name is required.
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" name="email" id="email" class="form-control" placeholder="you@example.com" required>
                                    <div class="invalid-feedback email-error">
                                        Please enter a valid email address for shipping updates.
                                    </div>
                                </div>
                
                                <div class="col-12">
                                    <label for="mobile" class="form-label">Mobile</label>
                                    <input type="text" name="mobile" id="mobile" class="form-control" placeholder="+8801234567890" required>
                                    <div class="invalid-feedback mobile-error">
                                        Valid Mobile is required.
                                    </div>
                                </div>
                
                                <div class="col-12">
                                    <label for="password" class="form-label">Password</label>
                                    <input type="password" name="password" id="password" class="form-control" placeholder="Password" required>
                                    <div class="invalid-feedback password-error">
                                        Your password is required.
                                    </div>
                                </div>
                            </div>
                
                            <div class="invalid-feedback common-error"></div>

                            <hr class="my-4">
                
                            <button class="w-100 btn btn-primary btn-lg" type="submit">Register</button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>
        
        <script src="./js/script.js"></script>
        <script>

            const form = document.querySelector("#add-user-form");

            form.onsubmit = async function(event) {
                event.preventDefault();

                const formData = new URLSearchParams(new FormData(form));

                let response = await fetch("/users/add", {
                    method: "POST",
                    body: formData
                });

                let result = await response.json();

                if(result.errors) {
                    Object.keys(result.errors).forEach((fieldName) => {
                        form[fieldName].classList.add("is-invalid");
                    });
                    const errorPlaceholder = document.querySelector(`.${fieldName}-error`);
                    errorPlaceholder.innerHTML  = result.errors[fieldName].msg;
                    errorPlaceholder.style.display = "block";
                }
                else {
                    document.querySelector("div.invalid-feedback").style.display = "none";
                    setTimeout(() => {
                        location.replace("/users");
                    }, 1000);
                }
            }

        </script>
    
    </body>
</html>
